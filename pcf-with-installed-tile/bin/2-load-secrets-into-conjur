#!/bin/bash -e

# get a Conjur CLI container running and load the root policy
docker pull conjurinc/cli5
docker run --rm -it -v $PWD:/work -w /work \
  -e CONJUR_AUTHN_API_KEY="$API_KEY" \
  -e CONJUR_AUTHN_LOGIN="admin" \
  -e CONJUR_ACCOUNT="$ACCOUNT" \
  -e CONJUR_APPLIANCE_URL="${APPLIANCE_URL:-'https://eval.conjur.org'}" \
  --entrypoint bash cyberark/conjur-cli:5 -ec '
    conjur policy load root policy/policy.yml
    conjur policy load root policy/cf.yml

    conjur policy load cf policy/org.yml
    conjur policy load cf policy/space.yml

    conjur variable values add cf/org/database/username "organization database username"
    conjur variable values add cf/org/database/password "organization database password"

    conjur variable values add cf/space/database/username "space database username"
    conjur variable values add cf/space/database/password "space database password"
  '
